<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1"> 1</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T30U3">cl</span> = <span class="message warning" id="M1F1C">splx_colors</span>(<span class="var type1" id="S3T1U6">lim</span>,<span class="var type1" id="S4T10U7">I</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2"> 2</a></span><span class="line">  </span></span>
<span class="srcline"><span class="lineno"><a href="1,3"> 3</a></span><span class="line">  <span class="mxinfo" id="T5:U4"><span class="var type1" id="S5T5U10">S</span> = <span class="mxinfo" id="T5:U6">max(<span class="mxinfo" id="T3:U7"><span class="var type1" id="S3T1U14">lim</span>(:)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,4"> 4</a></span><span class="line">  <span class="mxinfo" id="T6:U9">[<span class="var type1" id="S7T5U19">r</span> <span class="var type1" id="S8T5U20">c</span> <span class="mxinfo" id="T5:U12">~</span>] = size(<span class="var type1" id="S4T10U24">I</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,5"> 5</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,6"> 6</a></span><span class="line">  <span class="comment">%don't consider pixels at boundaries of superpixels </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,7"> 7</a></span><span class="line">  <span class="comment">%for computing mean color</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8"> 8</a></span><span class="line">  </span></span>
<span class="srcline"><span class="lineno"><a href="1,9"> 9</a></span><span class="line">  <span class="mxinfo" id="T11:U14"><span class="var type1" id="S10T11U27">lim_</span> = <span class="var type1" id="S3T1U28">lim</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,10">10</a></span><span class="line">  <span class="mxinfo" id="T11:U17">[<span class="var type1" id="S11T11U32">gx</span>,<span class="var type1" id="S12T11U33">gy</span>] = gradient(double(<span class="var type1" id="S3T1U38">lim</span>))</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,11">11</a></span><span class="line">  <span class="mxinfo" id="T13:U21"><span class="var type1" id="S15T13U41">gidx</span> = <span class="mxinfo" id="T13:U23"><span class="var type1" id="S11T11U43">gx</span> | <span class="var type1" id="S12T11U44">gy</span></span></span>;  </span></span>
<span class="srcline"><span class="lineno"><a href="1,12">12</a></span><span class="line">  <span class="mxinfo" id="T3:U26"><span class="mxinfo" id="T3:U27"><span class="var type1" id="S10T11U48">lim_</span>(<span class="var type1" id="S15T13U49">gidx</span>)</span> = <span class="mxinfo" id="T5:U30">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,13">13</a></span><span class="line">  </span></span>
<span class="srcline"><span class="lineno"><a href="1,14">14</a></span><span class="line">  </span></span>
<span class="srcline"><span class="lineno"><a href="1,15">15</a></span><span class="line">  <span class="mxinfo" id="T15:U31"><span class="var type1" id="S16T15U53">smean</span> = <span class="mxinfo" id="T15:U33">zeros(4,<span class="var type1" id="S5T5U57">S</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,16">16</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,17">17</a></span><span class="line">  <span class="mxinfo" id="T17:U35"><span class="var type1" id="S18T17U60">ssum2</span>=<span class="mxinfo" id="T17:U37">zeros(3,<span class="var type1" id="S5T5U64">S</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,18">18</a></span><span class="line">  <span class="mxinfo" id="T17:U39"><span class="var type1" id="S19T17U67">svar</span>=<span class="mxinfo" id="T17:U41">zeros(3,<span class="var type1" id="S5T5U71">S</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,19">19</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,20">20</a></span><span class="line">  <span class="keyword">for</span> <span class="var type1" id="S20T5U74">i</span>=<span class="mxinfo" id="T5:U44">1</span>:<span class="mxinfo" id="T5:U45"><span class="var type1" id="S7T5U78">r</span>*<span class="var type1" id="S8T5U79">c</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,21">21</a></span><span class="line">    <span class="mxinfo" id="T5:U48"><span class="var type1" id="S21T5U82">si</span> = <span class="mxinfo" id="T5:U50"><span class="var type1" id="S10T11U84">lim_</span>(<span class="var type1" id="S20T5U85">i</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,22">22</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T7:U53"><span class="var type1" id="S21T5U89">si</span>==<span class="mxinfo" id="T5:U55">0</span></span>, <span class="keyword">continue</span>; <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23">23</a></span><span class="line">    <span class="mxinfo" id="T16:U56"><span class="var type1" id="S22T16U94">rgb</span>=<span class="mxinfo" id="T16:U58">[<span class="mxinfo" id="T18:U59"><span class="var type1" id="S4T10U98">I</span>(<span class="var type1" id="S20T5U99">i</span>)</span>;<span class="mxinfo" id="T18:U62"><span class="var type1" id="S4T10U102">I</span>(<span class="mxinfo" id="T5:U64"><span class="var type1" id="S20T5U104">i</span>+<span class="mxinfo" id="T5:U66"><span class="var type1" id="S7T5U106">r</span>*<span class="var type1" id="S8T5U107">c</span></span></span>)</span>;<span class="mxinfo" id="T18:U69"><span class="var type1" id="S4T10U110">I</span>(<span class="mxinfo" id="T5:U71"><span class="var type1" id="S20T5U112">i</span>+<span class="mxinfo" id="T5:U73"><span class="mxinfo" id="T5:U74"><span class="mxinfo" id="T5:U75">2</span>*<span class="var type1" id="S7T5U116">r</span></span>*<span class="var type1" id="S8T5U117">c</span></span></span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,24">24</a></span><span class="line">    <span class="mxinfo" id="T29:U78"><span class="mxinfo" id="T29:U79"><span class="var type1" id="S16T15U121">smean</span>(<span class="mxinfo" id="T29:U81"><span class="mxinfo" id="T5:U82">1</span>:<span class="mxinfo" id="T5:U83">3</span></span>,<span class="var type1" id="S21T5U125">si</span>)</span> = <span class="mxinfo" id="T16:U85"><span class="mxinfo" id="T29:U86"><span class="var type1" id="S16T15U128">smean</span>(<span class="mxinfo" id="T29:U88"><span class="mxinfo" id="T5:U89">1</span>:<span class="mxinfo" id="T5:U90">3</span></span>,<span class="var type1" id="S21T5U132">si</span>)</span>+<span class="var type1" id="S22T16U133">rgb</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,25">25</a></span><span class="line">    <span class="mxinfo" id="T5:U93"><span class="mxinfo" id="T5:U94"><span class="var type1" id="S16T15U137">smean</span>(<span class="mxinfo" id="T5:U96">4</span>,<span class="var type1" id="S21T5U139">si</span>)</span> = <span class="mxinfo" id="T5:U98"><span class="mxinfo" id="T5:U99"><span class="var type1" id="S16T15U142">smean</span>(<span class="mxinfo" id="T5:U101">4</span>,<span class="var type1" id="S21T5U144">si</span>)</span>+<span class="mxinfo" id="T5:U103">1</span></span></span>;          </span></span>
<span class="srcline"><span class="lineno"><a href="1,26">26</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,27">27</a></span><span class="line">    <span class="mxinfo" id="T29:U104"><span class="mxinfo" id="T29:U105"><span class="var type1" id="S18T17U149">ssum2</span>(<span class="mxinfo" id="T31:U107">:</span>,<span class="var type1" id="S21T5U151">si</span>)</span>=<span class="mxinfo" id="T16:U109"><span class="mxinfo" id="T29:U110"><span class="var type1" id="S18T17U154">ssum2</span>(<span class="mxinfo" id="T31:U112">:</span>,<span class="var type1" id="S21T5U156">si</span>)</span>+<span class="mxinfo" id="T16:U114"><span class="var type1" id="S22T16U158">rgb</span>.^<span class="mxinfo" id="T5:U116">2</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,28">28</a></span><span class="line">  <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,29">29</a></span><span class="line"> </span></span>
<span class="srcline"><span class="lineno"><a href="1,30">30</a></span><span class="line">  <span class="comment">%some of the superpixels might have zero area</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,31">31</a></span><span class="line">  <span class="comment">%as the boundary pixels are not considered</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,32">32</a></span><span class="line">  <span class="comment">%recompute mean color with considering the boundary</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,33">33</a></span><span class="line">  <span class="mxinfo" id="T21:U117"><span class="var type1" id="S23T21U162">ii</span> = <span class="mxinfo" id="T21:U119">find(<span class="mxinfo" id="T20:U120"><span class="mxinfo" id="T21:U121"><span class="var type1" id="S16T15U167">smean</span>(<span class="mxinfo" id="T5:U123">4</span>,<span class="mxinfo" id="T14:U124">:</span>)</span>==<span class="mxinfo" id="T5:U125">0</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,34">34</a></span><span class="line">  <span class="keyword">for</span> <span class="var type1" id="S20T5U173">i</span>=<span class="mxinfo" id="T5:U127">1</span>:<span class="mxinfo" id="T5:U128">length(<span class="var type1" id="S23T21U178">ii</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,35">35</a></span><span class="line">    <span class="mxinfo" id="T3:U130"><span class="var type1" id="S26T3U181">ii2</span> = <span class="mxinfo" id="T3:U132">find(<span class="mxinfo" id="T32:U133"><span class="var type1" id="S3T1U185">lim</span>==<span class="mxinfo" id="T5:U135"><span class="var type1" id="S23T21U187">ii</span>(<span class="var type1" id="S20T5U188">i</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,36">36</a></span><span class="line">    <span class="mxinfo" id="T5:U138"><span class="var type1" id="S27T5U191">num</span> = <span class="mxinfo" id="T5:U140">length(<span class="var type1" id="S26T3U194">ii2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,37">37</a></span><span class="line">    <span class="mxinfo" id="T27:U142"><span class="var type1" id="S22T27U197">rgb</span>=<span class="mxinfo" id="T27:U144">[<span class="mxinfo" id="T33:U145"><span class="var type1" id="S4T10U201">I</span>(<span class="var type1" id="S26T3U203">ii2</span>')</span>;<span class="mxinfo" id="T33:U148"><span class="var type1" id="S4T10U206">I</span>(<span class="mxinfo" id="T21:U150"><span class="mxinfo" id="T21:U151"><span class="var type1" id="S26T3U209">ii2</span>'</span>+<span class="mxinfo" id="T5:U153"><span class="var type1" id="S7T5U211">r</span>*<span class="var type1" id="S8T5U212">c</span></span></span>)</span>;<span class="mxinfo" id="T33:U156"><span class="var type1" id="S4T10U215">I</span>(<span class="mxinfo" id="T21:U158"><span class="mxinfo" id="T21:U159"><span class="var type1" id="S26T3U218">ii2</span>'</span>+<span class="mxinfo" id="T5:U161"><span class="mxinfo" id="T5:U162"><span class="mxinfo" id="T5:U163">2</span>*<span class="var type1" id="S7T5U222">r</span></span>*<span class="var type1" id="S8T5U223">c</span></span></span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,38">38</a></span><span class="line">    <span class="mxinfo" id="T29:U166"><span class="mxinfo" id="T29:U167"><span class="var type1" id="S16T15U227">smean</span>(<span class="mxinfo" id="T29:U169"><span class="mxinfo" id="T5:U170">1</span>:<span class="mxinfo" id="T5:U171">3</span></span>,<span class="mxinfo" id="T5:U172"><span class="var type1" id="S23T21U232">ii</span>(<span class="var type1" id="S20T5U233">i</span>)</span>)</span> = <span class="mxinfo" id="T16:U175">sum(<span class="var type1" id="S22T27U236">rgb</span>,2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,39">39</a></span><span class="line">    <span class="mxinfo" id="T5:U177"><span class="mxinfo" id="T5:U178"><span class="var type1" id="S16T15U241">smean</span>(<span class="mxinfo" id="T5:U180">4</span>,<span class="mxinfo" id="T5:U181"><span class="var type1" id="S23T21U244">ii</span>(<span class="var type1" id="S20T5U245">i</span>)</span>)</span> = <span class="var type1" id="S27T5U246">num</span></span>;    </span></span>
<span class="srcline"><span class="lineno"><a href="1,40">40</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,41">41</a></span><span class="line">    <span class="mxinfo" id="T29:U185"><span class="mxinfo" id="T29:U186"><span class="var type1" id="S18T17U250">ssum2</span>(<span class="mxinfo" id="T31:U188">:</span>,<span class="mxinfo" id="T5:U189"><span class="var type1" id="S23T21U253">ii</span>(<span class="var type1" id="S20T5U254">i</span>)</span>)</span>=<span class="mxinfo" id="T16:U192">sum(<span class="mxinfo" id="T27:U193"><span class="var type1" id="S22T27U258">rgb</span>.^2</span>,2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,42">42</a></span><span class="line">  <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,43">43</a></span><span class="line">  </span></span>
<span class="srcline"><span class="lineno"><a href="1,44">44</a></span><span class="line">  <span class="mxinfo" id="T21:U195"><span class="var type1" id="S23T21U263">ii</span> = <span class="mxinfo" id="T21:U197">find(<span class="mxinfo" id="T20:U198"><span class="mxinfo" id="T21:U199"><span class="var type1" id="S16T15U268">smean</span>(<span class="mxinfo" id="T5:U201">4</span>,<span class="mxinfo" id="T14:U202">:</span>)</span>&gt;<span class="mxinfo" id="T5:U203">1</span></span>)</span></span>;  </span></span>
<span class="srcline"><span class="lineno"><a href="1,45">45</a></span><span class="line">  <span class="mxinfo" id="T17:U204"><span class="var type1" id="S29T17U274">n</span>=(<span class="mxinfo" id="T17:U206">[1;1;1]*<span class="mxinfo" id="T21:U207"><span class="var type1" id="S16T15U285">smean</span>(<span class="mxinfo" id="T5:U209">4</span>,<span class="var type1" id="S23T21U287">ii</span>)</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,46">46</a></span><span class="line">  <span class="mxinfo" id="T17:U211"><span class="mxinfo" id="T17:U212"><span class="var type1" id="S19T17U291">svar</span>(<span class="mxinfo" id="T31:U214">:</span>,<span class="var type1" id="S23T21U293">ii</span>)</span> = <span class="mxinfo" id="T17:U216">(<span class="mxinfo" id="T17:U217"><span class="mxinfo" id="T17:U218"><span class="var type1" id="S18T17U298">ssum2</span>(<span class="mxinfo" id="T31:U220">:</span>,<span class="var type1" id="S23T21U300">ii</span>)</span> - <span class="mxinfo" id="T17:U222">(<span class="mxinfo" id="T17:U223"><span class="mxinfo" id="T17:U224"><span class="var type1" id="S16T15U305">smean</span>(<span class="mxinfo" id="T29:U226"><span class="mxinfo" id="T5:U227">1</span>:<span class="mxinfo" id="T5:U228">3</span></span>,<span class="var type1" id="S23T21U309">ii</span>)</span>.^2</span>)./<span class="var type1" id="S29T17U311">n</span></span></span>)./(<span class="mxinfo" id="T17:U231"><span class="var type1" id="S29T17U314">n</span> - <span class="mxinfo" id="T5:U233">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,47">47</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,48">48</a></span><span class="line">  <span class="mxinfo" id="T17:U234"><span class="mxinfo" id="T17:U235"><span class="var type1" id="S16T15U319">smean</span>(<span class="mxinfo" id="T31:U237">1:3</span>,<span class="var type1" id="S23T21U323">ii</span>)</span> = <span class="mxinfo" id="T17:U239"><span class="mxinfo" id="T17:U240"><span class="var type1" id="S16T15U326">smean</span>(<span class="mxinfo" id="T29:U242"><span class="mxinfo" id="T5:U243">1</span>:<span class="mxinfo" id="T5:U244">3</span></span>,<span class="var type1" id="S23T21U330">ii</span>)</span>./<span class="var type1" id="S29T17U331">n</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,49">49</a></span><span class="line">  </span></span>
<span class="srcline"><span class="lineno"><a href="1,50">50</a></span><span class="line">  <span class="comment">%snorm = sum(smean(1:3,:),1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,51">51</a></span><span class="line">  <span class="comment">%chrom = [smean(1,:);smean(2,:)]./([1;1]*(snorm+eps));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,52">52</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,53">53</a></span><span class="line">  <span class="mxinfo" id="T30:U247"><span class="var type1" id="S2T30U334">cl</span> = <span class="mxinfo" id="T30:U249">[<span class="mxinfo" id="T17:U250"><span class="var type1" id="S16T15U338">smean</span>(<span class="mxinfo" id="T29:U252"><span class="mxinfo" id="T5:U253">1</span>:<span class="mxinfo" id="T5:U254">3</span></span>,<span class="mxinfo" id="T14:U255">:</span>)</span>;<span class="var type1" id="S19T17U344">svar</span>]</span></span>;  </span></span>
<span class="srcline"><span class="lineno"><a href="1,54">54</a></span><span class="line">  </span></span>
</pre>
